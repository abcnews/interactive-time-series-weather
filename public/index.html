<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weather charts</title>
    <script src="index.js" async></script>

    <style type="text/css">
      #webpack-dev-server-client-overlay {
        display: none !important;
      }
      /* transparent iframes */
      html {
        color-scheme: light;
        --dark-background: #0e0e0e;
      }
      html[data-scheme='dark'] {
        color-scheme: dark;
      }
      /* hard-coded iframe colours */
      html[data-background='force'] {
        background: white;
        color: black;
      }
      html[data-background='force'][data-scheme='dark'] {
        background: var(--background, var(--dark-background, black));
        color: white;
      }

      body {
        margin: 0;
        padding: 0;
      }
      @font-face {
        font-family: ABCSans;
        src: url('https://res.abc.net.au/fonts/abcsansnova/20211112/abcsansnova-regular.woff2') format('woff2');
        font-style: normal;
        font-weight: 400;
        font-display: swap;
      }
      @font-face {
        font-family: ABCSans;
        src: url('https://res.abc.net.au/fonts/abcsansnova/20211112/abcsansnova-bold.woff2') format('woff2');
        font-style: normal;
        font-weight: 700;
        font-display: swap;
      }
    </style>
  </head>
  <body>
    <div data-mount id="interactivetimeseriesweathersparkline"></div>
    <script lang="text/javascript">
      (() => {
        /** closest [data-scheme] element to our iframe */
        const getSchemeInParent = () => {
          try {
            return Array.from(parent.document.querySelectorAll('iframe')).find((iframe) => iframe.src === String(window.location))?.closest('[data-scheme]');
          } catch (e) {}
        };

        const doc = document.documentElement;
        const setScheme = (isDark) => (doc.dataset['scheme'] = isDark ? 'dark' : 'light');

        let observer;
        const applyParentScheme = () => {
          if (observer) observer.disconnect();
          const scheme = getSchemeInParent();
          if (scheme) {
            const sync = () => setScheme(scheme.getAttribute('data-scheme') === 'dark');
            sync();
            observer = new MutationObserver(sync);
            observer.observe(scheme, { attributes: true, attributeFilter: ['data-scheme'] });
          }
        };

        if (getSchemeInParent()) {
          // if same-domain, observe colour scheme preference.
          applyParentScheme();
          parent.window.addEventListener('odyssey:api', update);
        } else {
          // x-domain uses prefers-colour-scheme & hard-codes the background colour
          // this may be wrong if the user has set a preference (in app/preview).
          doc.dataset['background'] = 'force';

          // newsapp background is black
          if (document.referrer.includes('newsapp.')) {
            doc.style.setProperty('--background', 'black');
          }
          setScheme(window.matchMedia('(prefers-color-scheme: dark)').matches);
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => setScheme(e.matches));
        }
      })();
    </script>
  </body>
</html>
